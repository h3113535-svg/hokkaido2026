<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°æ£®æ—åŒ—æµ·é“ä¹‹æ—… (å®Œæ•´é›²ç«¯ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #F0F9FF; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .header-curve { border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.5s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-slate-600">

    <div id="app" class="max-w-md mx-auto bg-slate-50 min-h-screen shadow-2xl relative pb-20 overflow-hidden">
        
        <transition name="fade">
            <div v-if="isLocked" class="absolute inset-0 z-[100] bg-blue-600 flex flex-col items-center justify-center text-white p-10">
                <i class="fa-solid fa-cloud text-6xl mb-4 opacity-80"></i>
                <h2 class="text-2xl font-bold mb-2">åŒ—æµ·é“å®¶æ—é›²ç«¯</h2>
                <p class="text-sm opacity-80 mb-8">å››æ©Ÿé€£ç·šä¸­ãƒ»è«‹è¼¸å…¥å¯†ç¢¼</p>
                <div class="flex space-x-4 mb-8">
                    <div v-for="(digit, idx) in inputPassword" :key="idx" class="w-4 h-4 rounded-full" :class="digit ? 'bg-white' : 'bg-blue-400'"></div>
                </div>
                <div class="grid grid-cols-3 gap-6 w-64">
                    <button v-for="n in 9" :key="n" @click="enterDigit(n)" class="w-16 h-16 rounded-full border-2 border-blue-400 flex items-center justify-center text-xl font-bold active:bg-blue-500 transition">{{ n }}</button>
                    <div class="col-start-2">
                        <button @click="enterDigit(0)" class="w-16 h-16 rounded-full border-2 border-blue-400 flex items-center justify-center text-xl font-bold active:bg-blue-500 transition">0</button>
                    </div>
                    <div class="col-start-3 flex items-center justify-center">
                        <button @click="backspace()" class="w-16 h-16 flex items-center justify-center text-xl active:opacity-50"><i class="fa-solid fa-delete-left"></i></button>
                    </div>
                </div>
                <p v-if="loginError" class="mt-4 text-yellow-300 font-bold animate-pulse">å¯†ç¢¼éŒ¯èª¤</p>
            </div>
        </transition>

        <header class="relative z-10">
            <div class="h-[250px] w-full bg-blue-200 header-curve overflow-hidden relative shadow-lg">
                <img src="https://images.unsplash.com/photo-1548266652-99cf27701ced?q=80&w=1920&auto=format&fit=crop" 
                     alt="Hokkaido Banner" class="w-full h-full object-cover object-center opacity-90">
                <div class="absolute bottom-12 left-6 text-white text-shadow">
                    <h1 class="text-2xl font-bold tracking-widest drop-shadow-md">HOKKAIDO</h1>
                    <p class="text-sm font-light tracking-wider drop-shadow-md">Family Trip 2025</p>
                </div>
                <div class="absolute top-4 right-4 bg-black/30 backdrop-blur-md text-white text-[10px] px-3 py-1 rounded-full flex items-center">
                    <div class="w-2 h-2 rounded-full mr-2" :class="dbConnected ? 'bg-green-400' : 'bg-red-400 animate-pulse'"></div>
                    {{ dbConnected ? 'å·²é€£ç·šåŒæ­¥ä¸­' : 'é€£ç·šä¸­...' }}
                </div>
            </div>
            
            <div class="absolute -bottom-6 right-4 flex space-x-3 z-20">
                <button v-for="tab in ['schedule', 'info', 'shopping', 'expense']" 
                        @click="currentTab = tab" 
                        :class="tabClass(tab)" 
                        class="w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all transform hover:-translate-y-1">
                    <i :class="getTabIcon(tab)" class="text-lg"></i>
                </button>
            </div>
        </header>

        <main class="relative z-0 -mt-4 pt-10 px-4 min-h-[500px]">

            <div v-if="currentTab === 'schedule'">
                <div class="flex overflow-x-auto space-x-3 pb-4 hide-scrollbar mb-2">
                    <div v-for="(day, index) in scheduleData" :key="index" @click="selectedDayIndex = index"
                         :class="selectedDayIndex === index ? 'bg-blue-500 text-white ring-4 ring-blue-100' : 'bg-white text-slate-400'"
                         class="flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center cursor-pointer shadow-sm border border-slate-100 transition-all">
                        <span class="text-xs font-medium">{{ day.weekday }}</span>
                        <span class="text-2xl font-bold font-mono">{{ day.date }}</span>
                        <span class="text-[10px] opacity-80">D{{ index + 1 }}</span>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-blue-400 to-cyan-300 text-white rounded-2xl p-4 mb-6 shadow-md flex justify-between items-center relative overflow-hidden">
                    <div class="relative z-10">
                        <div class="text-xs opacity-90">{{ currentSchedule.location }}</div>
                        <div class="text-3xl font-bold mt-1">12Â°C <span class="text-sm font-normal">æ™´</span></div>
                    </div>
                    <i class="fa-solid fa-cloud-sun text-5xl opacity-80 relative z-10"></i>
                </div>

                <div class="space-y-0">
                    <div v-for="(item, idx) in currentSchedule.events" :key="idx" class="relative pl-6 pb-8 border-l-2 border-dashed border-blue-200 last:border-0">
                        <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-blue-500 ring-4 ring-blue-100"></div>
                        
                        <div v-if="idx > 0" class="flex items-center text-xs text-slate-400 mb-2 ml-1">
                            <i :class="getTransportIcon(item.transportType)" class="mr-2"></i><span>{{ item.travelTime }}</span>
                        </div>
                        <div v-else-if="idx === 0" class="flex items-center text-xs text-slate-400 mb-2 ml-1">
                             <i class="fa-solid fa-bed mr-2"></i><span>å¾ä½å®¿å‡ºç™¼</span>
                        </div>

                        <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden">
                            <span :class="getCategoryColor(item.category)" class="absolute top-0 right-0 px-3 py-1 text-[10px] rounded-bl-xl font-bold text-white">{{ item.category }}</span>
                            <div class="flex items-start">
                                <div class="mr-3 mt-1 text-blue-500 text-xl"><i :class="getCategoryIcon(item.category)"></i></div>
                                <div class="flex-1">
                                    <h3 class="font-bold text-slate-700 text-lg leading-tight mb-1">{{ item.title }}</h3>
                                    <p class="text-xs text-slate-500 font-mono mb-2"><i class="fa-regular fa-clock mr-1"></i>{{ item.time }}</p>
                                    <p v-if="item.note" class="text-sm text-slate-600 bg-slate-50 p-2 rounded-lg mb-2">{{ item.note }}</p>
                                    <a :href="'https://www.google.com/maps/search/?api=1&query=' + item.title" target="_blank" class="inline-flex items-center text-xs font-bold text-blue-500 mt-1"><i class="fa-solid fa-location-arrow mr-1"></i> å°èˆª</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'info'" class="space-y-4">
                <h2 class="text-xl font-bold text-slate-800">æ—…è¡Œè³‡è¨Š</h2>
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="font-bold text-blue-600 mb-2"><i class="fa-solid fa-coins mr-2"></i>åŒ¯ç‡è©¦ç®—</h3>
                    <div class="flex items-center space-x-2">
                        <input v-model="yenAmount" type="number" class="w-full bg-slate-50 rounded-lg p-2 outline-none" placeholder="æ—¥å¹£">
                        <i class="fa-solid fa-arrow-right text-slate-300"></i>
                        <span class="font-bold text-lg text-slate-700">{{ calculatedTwd }} å°å¹£</span>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div v-for="info in infoCards" class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center justify-center h-32">
                        <div :class="info.bgClass" class="w-10 h-10 rounded-full flex items-center justify-center mb-2"><i :class="info.icon" class="text-xl"></i></div>
                        <span class="font-bold text-sm">{{ info.title }}</span>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'shopping'">
                <h2 class="text-xl font-bold text-slate-800 mb-4">å…¨å®¶è³¼ç‰©é¡˜æœ›æ¸…å–® <span class="text-xs font-normal text-slate-400 ml-2">(åŒæ­¥ä¸­)</span></h2>
                
                <div v-if="loading" class="flex justify-center py-10"><div class="loader"></div></div>
                
                <div v-else-if="shoppingList.length === 0" class="text-center py-10 text-slate-400">
                    <i class="fa-solid fa-basket-shopping text-4xl mb-3 opacity-30"></i>
                    <p>æ¸…å–®æ˜¯ç©ºçš„ï¼Œå¿«ä¾†è¨±é¡˜ï¼</p>
                </div>

                <div v-for="(item) in shoppingList" :key="item.id" class="bg-white rounded-2xl shadow-sm border border-slate-100 p-4 mb-3 flex items-center relative group">
                    <button @click="deleteItem('shopping', item.id)" class="absolute top-2 right-2 text-slate-300 hover:text-red-400"><i class="fa-solid fa-times"></i></button>
                    <div class="w-12 h-12 bg-slate-100 rounded-lg mr-4 flex items-center justify-center text-slate-300"><i class="fa-solid fa-gift"></i></div>
                    <div class="flex-1">
                        <h4 class="font-bold text-slate-700" :class="{'line-through text-slate-300': item.checked}">{{ item.name }}</h4>
                        <p class="text-xs text-slate-400">é ç®—: Â¥{{ item.price }} <span v-if="item.creator" class="ml-2 bg-blue-100 text-blue-600 px-1 rounded">by {{ item.creator }}</span></p>
                    </div>
                    <input type="checkbox" :checked="item.checked" @change="toggleCheck(item.id, item.checked)" class="w-6 h-6 text-blue-500 rounded focus:ring-blue-500">
                </div>

                <button @click="showAddModal = 'shopping'" class="fixed bottom-6 right-6 w-14 h-14 bg-slate-800 text-white rounded-full shadow-2xl flex items-center justify-center text-2xl z-50 hover:scale-110 transition"><i class="fa-solid fa-plus"></i></button>
            </div>

            <div v-if="currentTab === 'expense'">
                <h2 class="text-xl font-bold text-slate-800 mb-4">å…±åŒæ—…è²»è¨˜å¸³ <span class="text-xs font-normal text-slate-400 ml-2">(åŒæ­¥ä¸­)</span></h2>
                
                <div class="bg-slate-800 text-white rounded-2xl p-6 mb-6 shadow-lg text-center">
                    <p class="text-sm opacity-70 mb-1">ç›®å‰ç¸½èŠ±è²» (TWD)</p>
                    <h3 class="text-4xl font-bold font-mono">{{ totalExpenseTWD.toLocaleString() }}</h3>
                </div>

                <div v-if="loading" class="flex justify-center py-5"><div class="loader"></div></div>

                <div class="space-y-3 pb-20">
                    <div v-for="(exp) in expenseList" :key="exp.id" class="flex justify-between items-center bg-white p-4 rounded-xl shadow-sm border border-slate-50 relative">
                        <button @click="deleteItem('expense', exp.id)" class="absolute top-2 right-2 text-[10px] text-slate-200 hover:text-red-400"><i class="fa-solid fa-trash"></i></button>
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-full bg-yellow-50 text-yellow-500 flex items-center justify-center mr-3"><i class="fa-solid fa-yen-sign"></i></div>
                            <div>
                                <p class="font-bold text-sm">{{ exp.name }} <span v-if="exp.creator" class="text-[10px] text-slate-400 font-normal">({{ exp.creator }})</span></p>
                                <p class="text-xs text-slate-400">{{ exp.date }}</p>
                            </div>
                        </div>
                        <span class="font-mono font-bold text-slate-700">Â¥ {{ Number(exp.amount).toLocaleString() }}</span>
                    </div>
                </div>
                
                <button @click="showAddModal = 'expense'" class="fixed bottom-6 right-6 w-14 h-14 bg-slate-800 text-white rounded-full shadow-2xl flex items-center justify-center text-2xl z-50 hover:scale-110 transition"><i class="fa-solid fa-plus"></i></button>
            </div>

        </main>

        <div v-if="showAddModal" class="fixed inset-0 bg-black/50 z-[60] flex items-end sm:items-center justify-center p-4">
            <div class="bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl animate-bounce-in">
                <h3 class="text-lg font-bold mb-4">{{ showAddModal === 'shopping' ? 'æ–°å¢é¡˜æœ›' : 'æ–°å¢èŠ±è²»' }}</h3>
                <div class="space-y-3">
                    <div><label class="block text-xs text-slate-400 mb-1">åç¨±</label><input v-model="newItem.name" type="text" class="w-full bg-slate-100 rounded-lg p-3 outline-none"></div>
                    <div><label class="block text-xs text-slate-400 mb-1">é‡‘é¡ (Â¥)</label><input v-model="newItem.amount" type="number" class="w-full bg-slate-100 rounded-lg p-3 outline-none"></div>
                    <div><label class="block text-xs text-slate-400 mb-1">æ˜¯èª°æ–°å¢çš„ï¼Ÿ</label>
                        <select v-model="newItem.creator" class="w-full bg-slate-100 rounded-lg p-3 outline-none">
                            <option value="çˆ¸çˆ¸">çˆ¸çˆ¸</option><option value="åª½åª½">åª½åª½</option><option value="å§Šå§Š">å§Šå§Š</option><option value="å¦¹å¦¹">å¦¹å¦¹</option>
                        </select>
                    </div>
                    <div v-if="showAddModal === 'expense'"><label class="block text-xs text-slate-400 mb-1">æ—¥æœŸ</label><input v-model="newItem.date" type="date" class="w-full bg-slate-100 rounded-lg p-3 outline-none"></div>
                </div>
                <div class="flex space-x-3 mt-6">
                    <button @click="closeModal" class="flex-1 py-3 rounded-xl bg-slate-100 text-slate-500 font-bold">å–æ¶ˆ</button>
                    <button @click="confirmAdd" class="flex-1 py-3 rounded-xl bg-blue-500 text-white font-bold">é€å‡º</button>
                </div>
            </div>
        </div>

    </div>

    <script type="module">
        import { createApp } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js';
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // ğŸ”´ è«‹å°‡æ‚¨å¾ Firebase è¤‡è£½çš„è¨­å®šè²¼åœ¨ä¸‹æ–¹å–ä»£é€™å€‹å€å¡Š ğŸ”´
const firebaseConfig = {
  apiKey: "AIzaSyC67N7fPsE8dHL3GMVfFpyfgrvDnE5AaVQ",
  authDomain: "hokkaido2026-b35fc.firebaseapp.com",
  databaseURL: "https://hokkaido2026-b35fc-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "hokkaido2026-b35fc",
  storageBucket: "hokkaido2026-b35fc.firebasestorage.app",
  messagingSenderId: "553111751124",
  appId: "1:553111751124:web:e15688b7b8966926882e41"
};
        // ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´

        // åˆå§‹åŒ– Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // å®Œæ•´è¡Œç¨‹è³‡æ–™ D1-D9
        const scheduleData = [
            {
                date: "25", weekday: "Fri", location: "å‡½é¤¨",
                events: [
                    { time: "13:00", title: "æŠµé”æ–°åƒæ­²è½‰åœ‹å…§ç·š", category: "èˆªç­", transportType: "plane", travelTime: "1h", note: "è½‰æ©Ÿå¾€å‡½é¤¨ (JRå‚™æ¡ˆ: 15:30å—åƒæ­²)" },
                    { time: "16:30", title: "å‡½é¤¨ Check-in", category: "ä½å®¿", transportType: "taxi", travelTime: "20m", note: "å‡½é¤¨ç«™å‰é£¯åº—" },
                    { time: "17:30", title: "å‡½é¤¨æœå¸‚ / é‡‘æ£®å€‰åº«", category: "æ™¯é»", transportType: "walk", travelTime: "10m", note: "æ•£æ­¥è¡Œç¨‹" },
                    { time: "19:00", title: "æ ¹å®¤èŠ±ä¸¸å£½å¸", category: "ç¾é£Ÿ", transportType: "walk", travelTime: "5m", note: "æ™šé¤" }
                ]
            },
            {
                date: "26", weekday: "Sat", location: "å‡½é¤¨",
                events: [
                    { time: "09:00", title: "æ«»ä¸˜é€šè³æ«»", category: "æ™¯é»", transportType: "taxi", travelTime: "15m", note: "å¸‚é›»å¯é”" },
                    { time: "10:30", title: "äº”ç¨œéƒ­å…¬åœ’", category: "æ™¯é»", transportType: "walk", travelTime: "10m", note: "ç™»ä¸Šå¡”çœ‹æ˜Ÿå½¢è¦å¡" },
                    { time: "12:30", title: "å°ä¸‘æ¼¢å ¡", category: "ç¾é£Ÿ", transportType: "walk", travelTime: "5m", note: "å¿…åƒ!" },
                    { time: "15:30", title: "é‡‘æ£®å€‰åº«/æ˜Ÿå·´å…‹", category: "è³¼ç‰©", transportType: "bus", travelTime: "20m", note: "ä¼‘æ¯ã€éŠœæ¥æ™‚é–“" },
                    { time: "17:30", title: "å‡½é¤¨å±±å¤œæ™¯", category: "æ™¯é»", transportType: "bus", travelTime: "20m", note: "çœ‹ Magic Hour" }
                ]
            },
            {
                date: "27", weekday: "Sun", location: "å‡½é¤¨",
                events: [
                    { time: "09:00", title: "å‡½é¤¨æœå¸‚ (é‡£çƒè³Š?)", category: "ç¾é£Ÿ", transportType: "taxi", travelTime: "10m", note: "æ—©é¤/æ—©åˆé¤" },
                    { time: "11:00", title: "å…ƒç”ºæ•™æœƒç¾¤", category: "æ™¯é»", transportType: "walk", travelTime: "15m", note: "å……æ»¿ç•°åœ‹é¢¨æƒ…" },
                    { time: "15:00", title: "å‡½é¤¨å…¬åœ’", category: "æ™¯é»", transportType: "bus", travelTime: "20m", note: "è³æ«»" },
                    { time: "16:30", title: "é‡‘æ£®å€‰åº«æœ€å¾Œæ¡è²·", category: "è³¼ç‰©", transportType: "taxi", travelTime: "10m", note: "Snaffle's èµ·å¸è›‹ç³•" },
                    { time: "18:30", title: "é˜¿ä½åˆ©å£½å–œç‡’", category: "ç¾é£Ÿ", transportType: "walk", travelTime: "5m", note: "éœ€é ç´„" }
                ]
            },
            {
                date: "28", weekday: "Mon", location: "å¤§æ²¼/äºŒä¸–è°·",
                events: [
                    { time: "09:30", title: "å‡½é¤¨å–è»Š & å¯„è¡Œæ", category: "ç§Ÿè»Š", transportType: "walk", travelTime: "10m", note: "è‡ªé§•é–‹å§‹ï¼å¯„2ç®±è¡Œæåˆ°æœ­å¹Œ" },
                    { time: "10:30", title: "å¤§æ²¼åœ‹å®šå…¬åœ’", category: "æ™¯é»", transportType: "car", travelTime: "40m", note: "é¢¨æ™¯å„ªç¾" },
                    { time: "12:00", title: "æ£®ç”ºãƒ»é’è‘‰ä¸˜", category: "æ™¯é»", transportType: "car", travelTime: "20m", note: "è³æ«»é»" },
                    { time: "14:30", title: "Silo å±•æœ›å°", category: "æ™¯é»", transportType: "car", travelTime: "90m", note: "æ´çˆºæ¹–æ™¯è§€" },
                    { time: "15:30", title: "Lake Hill Farm", category: "ç¾é£Ÿ", transportType: "car", travelTime: "10m", note: "åƒå†°æ·‡æ·‹" },
                    { time: "18:00", title: "å…¥ä½äºŒä¸–è°·åˆ¥å¢…", category: "ä½å®¿", transportType: "car", travelTime: "40m", note: "æ™šé¤ï¼šæµ·é®®ç«é‹" }
                ]
            },
            {
                date: "29", weekday: "Tue", location: "æ´çˆºæ¹–",
                events: [
                    { time: "11:00", title: "å‡ºç™¼æ´çˆºæ¹–", category: "äº¤é€š", transportType: "car", travelTime: "0m", note: "ç¡åˆ°è‡ªç„¶é†’" },
                    { time: "12:30", title: "æœ‰ç å±±çºœè»Š", category: "æ™¯é»", transportType: "car", travelTime: "60m", note: "çœ‹ç«å±±åœ°å½¢" },
                    { time: "14:30", title: "æ´çˆºæ¹–éŠè¦½èˆ¹", category: "æ™¯é»", transportType: "car", travelTime: "20m", note: "ä¸­å³¶è³æ«»" },
                    { time: "17:00", title: "è¶…å¸‚è£œè²¨", category: "è³¼ç‰©", transportType: "car", travelTime: "15m", note: "è²·æ™šé¤é£Ÿæ" },
                    { time: "19:00", title: "åˆ¥å¢…æ™šé¤", category: "ç¾é£Ÿ", transportType: "walk", travelTime: "0m", note: "æ¹¯å’–å“©" }
                ]
            },
            {
                date: "30", weekday: "Wed", location: "ç™»åˆ¥",
                events: [
                    { time: "10:00", title: "å‡ºç™¼ç™»åˆ¥", category: "äº¤é€š", transportType: "car", travelTime: "0m", note: "è»Šç¨‹è¼ƒé•·" },
                    { time: "11:30", title: "ç™»åˆ¥æ«»èŠ±éš§é“", category: "æ™¯é»", transportType: "car", travelTime: "90m", note: "è³æ«»" },
                    { time: "13:30", title: "ç™»åˆ¥åœ°ç„è°·", category: "æ™¯é»", transportType: "car", travelTime: "10m", note: "ç‰¹æ®Šåœ°ç†±æ™¯è§€" },
                    { time: "16:00", title: "é«˜æ©‹ç‰§å ´", category: "ç¾é£Ÿ", transportType: "car", travelTime: "80m", note: "å›ç¨‹é †è·¯" },
                    { time: "17:00", title: "äº¬æ¥µåæ°´å…¬åœ’", category: "æ™¯é»", transportType: "car", travelTime: "20m", note: "è£åæ°´å›åˆ¥å¢…ç…®é£¯" },
                    { time: "19:00", title: "åˆ¥å¢…æ™šé¤", category: "ç¾é£Ÿ", transportType: "walk", travelTime: "0m", note: "å’Œç‰›ç‡’è‚‰" }
                ]
            },
            {
                date: "01", weekday: "Thu", location: "å°æ¨½/æœ­å¹Œ",
                events: [
                    { time: "10:00", title: "äºŒä¸–è°·é‚„è»Š & åŒ…è»Š", category: "ç§Ÿè»Š", transportType: "car", travelTime: "0m", note: "æ› Alphard åŒ…è»Š" },
                    { time: "11:30", title: "ä½™å¸‚é…’å» +å ¤é˜²", category: "æ™¯é»", transportType: "car", travelTime: "60m", note: "å¨å£«å¿Œèˆ‡æ«»èŠ±" },
                    { time: "13:00", title: "å°æ¨½é‹æ²³ & åˆé¤", category: "æ™¯é»", transportType: "car", travelTime: "30m", note: "è‹¥é›æ™‚ä»£ / æ”¿å£½å¸" },
                    { time: "15:00", title: "å ºç”ºé€š / æ‰‹å®®å…¬åœ’", category: "è³¼ç‰©", transportType: "walk", travelTime: "10m", note: "åƒç”œé»ã€è³æ«»" },
                    { time: "17:30", title: "æœ­å¹Œ Check-in", category: "ä½å®¿", transportType: "car", travelTime: "50m", note: "è¡Œæåˆé«”ï¼Œæ™šé¤æ¹¯å’–å“©" }
                ]
            },
            {
                date: "02", weekday: "Fri", location: "æœ­å¹Œ",
                events: [
                    { time: "10:00", title: "åŒ—æµ·é“ç¥å®®", category: "æ™¯é»", transportType: "subway", travelTime: "20m", note: "åƒæ‹œ" },
                    { time: "11:30", title: "åœ“å±±å…¬åœ’", category: "æ™¯é»", transportType: "walk", travelTime: "5m", note: "é‡é¤/è³æ«»" },
                    { time: "12:30", title: "åœ“å±±å’–å•¡å»³", category: "ç¾é£Ÿ", transportType: "walk", travelTime: "10m", note: "åˆé¤" },
                    { time: "14:30", title: "åŒ—æµ·é“å¤§å­¸", category: "æ™¯é»", transportType: "subway", travelTime: "20m", note: "æ ¡åœ’æ•£æ­¥" },
                    { time: "16:30", title: "ç‹¸å°è·¯é€›è¡—", category: "è³¼ç‰©", transportType: "subway", travelTime: "15m", note: "è—¥å¦ã€ä¼´æ‰‹ç¦®" },
                    { time: "18:30", title: "æˆå‰æ€æ±—çƒ¤è‚‰", category: "ç¾é£Ÿ", transportType: "walk", travelTime: "10m", note: "å¤§å£åƒè‚‰" }
                ]
            },
            {
                date: "03", weekday: "Sat", location: "å›ç¨‹",
                events: [
                    { time: "10:30", title: "é£¯åº—æ¥é€", category: "äº¤é€š", transportType: "taxi", travelTime: "0m", note: "å°ˆè»Šç›´é”æ©Ÿå ´" },
                    { time: "11:30", title: "æ–°åƒæ­²æ©Ÿå ´", category: "è³¼ç‰©", transportType: "car", travelTime: "50m", note: "æœ€å¾Œæ¡è²·" },
                    { time: "13:00", title: "æ­æ©Ÿè¿”å°", category: "èˆªç­", transportType: "plane", travelTime: "0m", note: "ç”œèœœçš„å®¶" }
                ]
            }
        ];

        createApp({
            data() {
                return {
                    isLocked: true, password: ['2','0','2','5'], inputPassword: [], loginError: false,
                    currentTab: 'schedule', scheduleData: scheduleData, selectedDayIndex: 0,
                    yenAmount: 1000, exchangeRate: 0.215,
                    
                    // é›²ç«¯è³‡æ–™å®¹å™¨
                    shoppingList: [],
                    expenseList: [],
                    loading: true,
                    dbConnected: false,

                    showAddModal: null,
                    newItem: { name: '', amount: '', date: '', creator: 'åª½åª½' },

                    infoCards: [
                        { title: 'èˆªç­è³‡è¨Š', bgClass: 'bg-blue-50 text-blue-500', icon: 'fa-solid fa-plane' },
                        { title: 'ä½å®¿åˆ—è¡¨', bgClass: 'bg-orange-50 text-orange-500', icon: 'fa-solid fa-hotel' },
                        { title: 'ç§Ÿè»Šè³‡è¨Š', bgClass: 'bg-green-50 text-green-500', icon: 'fa-solid fa-car' },
                        { title: 'ç·Šæ€¥é†«ç™‚', bgClass: 'bg-red-50 text-red-500', icon: 'fa-solid fa-suitcase-medical' }
                    ]
                }
            },
            mounted() {
                // ç›£è½è³¼ç‰©æ¸…å–®è®ŠåŒ–
                const shoppingRef = ref(db, 'shopping');
                onValue(shoppingRef, (snapshot) => {
                    const data = snapshot.val();
                    this.shoppingList = data ? Object.keys(data).map(key => ({ id: key, ...data[key] })) : [];
                    this.loading = false;
                    this.dbConnected = true;
                });

                // ç›£è½è¨˜å¸³è®ŠåŒ–
                const expenseRef = ref(db, 'expenses');
                onValue(expenseRef, (snapshot) => {
                    const data = snapshot.val();
                    this.expenseList = data ? Object.keys(data).map(key => ({ id: key, ...data[key] })) : [];
                });
                
                this.newItem.date = new Date().toISOString().split('T')[0];
            },
            computed: {
                currentSchedule() { return this.scheduleData[this.selectedDayIndex] || { events: [] }; },
                calculatedTwd() { return Math.round(this.yenAmount * this.exchangeRate).toLocaleString(); },
                totalExpenseTWD() { return Math.round(this.expenseList.reduce((sum, item) => sum + Number(item.amount), 0) * this.exchangeRate); }
            },
            methods: {
                // é–å®šé‚è¼¯
                enterDigit(n) { if(this.inputPassword.length<4) { this.inputPassword.push(String(n)); if(this.inputPassword.length===4) this.checkPassword(); } },
                backspace() { this.inputPassword.pop(); },
                checkPassword() { 
                    if(JSON.stringify(this.inputPassword) === JSON.stringify(this.password)) setTimeout(() => this.isLocked = false, 300);
                    else { this.loginError = true; setTimeout(() => { this.inputPassword=[]; this.loginError=false; }, 1000); }
                },
                
                // UI è¼”åŠ©
                tabClass(tab) { return this.currentTab === tab ? 'bg-blue-500 text-white scale-110' : 'bg-white text-slate-400 hover:bg-blue-50'; },
                getTabIcon(t) { return {'schedule':'fa-solid fa-map-location-dot','info':'fa-solid fa-circle-info','shopping':'fa-solid fa-basket-shopping','expense':'fa-solid fa-yen-sign'}[t]; },
                getCategoryColor(c) { return {'æ™¯é»':'bg-pink-400','ç¾é£Ÿ':'bg-orange-400','ä½å®¿':'bg-indigo-400','è³¼ç‰©':'bg-yellow-400','èˆªç­':'bg-blue-400','ç§Ÿè»Š':'bg-green-500','äº¤é€š':'bg-slate-400'}[c] || 'bg-gray-400'; },
                getCategoryIcon(c) { return {'æ™¯é»':'fa-solid fa-camera','ç¾é£Ÿ':'fa-solid fa-utensils','ä½å®¿':'fa-solid fa-bed','è³¼ç‰©':'fa-solid fa-bag-shopping','èˆªç­':'fa-solid fa-plane','ç§Ÿè»Š':'fa-solid fa-car','äº¤é€š':'fa-solid fa-train-subway'}[c] || 'fa-solid fa-circle'; },
                getTransportIcon(t) { return {'walk':'fa-solid fa-person-walking','car':'fa-solid fa-car-side','bus':'fa-solid fa-bus','subway':'fa-solid fa-train-subway','taxi':'fa-solid fa-taxi','plane':'fa-solid fa-plane-up'}[t] || 'fa-solid fa-arrow-right'; },

                // ğŸ”¥ Firebase æ“ä½œ ğŸ”¥
                closeModal() { this.showAddModal = null; this.newItem = { name:'', amount:'', date: new Date().toISOString().split('T')[0], creator: 'åª½åª½' }; },
                
                confirmAdd() {
                    if (!this.newItem.name) return;
                    if (this.showAddModal === 'shopping') {
                        push(ref(db, 'shopping'), {
                            name: this.newItem.name,
                            price: this.newItem.amount || 0,
                            creator: this.newItem.creator,
                            checked: false
                        });
                    } else {
                        push(ref(db, 'expenses'), {
                            name: this.newItem.name,
                            amount: this.newItem.amount || 0,
                            date: this.newItem.date,
                            creator: this.newItem.creator
                        });
                    }
                    this.closeModal();
                },

                deleteItem(type, id) {
                    if(!confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿé€™æœƒåŒæ­¥åˆªé™¤å¤§å®¶æ‰‹æ©Ÿè£¡çš„ç´€éŒ„å–”ï¼')) return;
                    const path = type === 'shopping' ? `shopping/${id}` : `expenses/${id}`;
                    remove(ref(db, path));
                },

                toggleCheck(id, currentStatus) {
                    update(ref(db, `shopping/${id}`), { checked: !currentStatus });
                }
            }
        }).mount('#app');
    </script>
</body>
</html>