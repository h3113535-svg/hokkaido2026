<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒ—æµ·é“ 2026 (æ«»èŠ±é£„è½ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            /* ä¸»èƒŒæ™¯ */
            background-image: url('https://images.unsplash.com/photo-1522383225653-ed111181a951?q=80&w=1920&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .header-curve { border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.8s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #f472b6; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ğŸŒ¸ æ«»èŠ±é£„è½å‹•ç•« */
        .sakura {
            position: absolute;
            top: -10%;
            color: #ffb7b2;
            opacity: 0.8;
            animation: fall linear infinite;
            pointer-events: none; /* è®“é»æ“Šç©¿é€ */
        }
        @keyframes fall {
            0% { top: -10%; transform: translateX(0) rotate(0deg); opacity: 0.8; }
            100% { top: 110%; transform: translateX(50px) rotate(360deg); opacity: 0; }
        }
    </style>
</head>
<body class="text-slate-600 overflow-x-hidden">

    <div id="app" class="max-w-md mx-auto bg-white/90 backdrop-blur-sm min-h-screen shadow-2xl relative pb-24">
        
        <transition name="fade">
            <div v-if="isLocked" class="fixed inset-0 z-[9999] flex flex-col items-center justify-center text-white overflow-hidden" 
                 style="background-image: url('https://images.unsplash.com/photo-1493589976221-c2157d91244d?q=80&w=1920&auto=format&fit=crop'); background-size: cover; background-position: center;">
                
                <div class="absolute inset-0 bg-black/30 backdrop-blur-[2px]"></div>

                <div class="absolute inset-0 overflow-hidden pointer-events-none">
                    <i class="fa-solid fa-seedling sakura text-xl" style="left: 10%; animation-duration: 5s; animation-delay: 0s;"></i>
                    <i class="fa-brands fa-pagelines sakura text-2xl" style="left: 30%; animation-duration: 7s; animation-delay: 1s;"></i>
                    <i class="fa-solid fa-leaf sakura text-lg" style="left: 50%; animation-duration: 4s; animation-delay: 2s;"></i>
                    <i class="fa-solid fa-seedling sakura text-xl" style="left: 70%; animation-duration: 6s; animation-delay: 0.5s;"></i>
                    <i class="fa-brands fa-pagelines sakura text-2xl" style="left: 90%; animation-duration: 5s; animation-delay: 3s;"></i>
                </div>

                <div class="relative z-10 flex flex-col items-center w-full max-w-xs p-6 bg-white/10 rounded-3xl border border-white/20 shadow-2xl backdrop-blur-md">
                    <div class="w-16 h-16 rounded-full bg-white/20 flex items-center justify-center mb-4 border border-white/30 animate-bounce">
                        <i class="fa-solid fa-lock text-2xl"></i>
                    </div>
                    <h2 class="text-3xl font-bold mb-1 tracking-widest text-shadow">åŒ—æµ·é“ 2026</h2>
                    <p class="text-sm opacity-90 mb-8 font-light tracking-wide">Family Spring Trip</p>
                    
                    <div class="flex space-x-4 mb-8 h-6">
                        <transition-group name="list">
                            <div v-for="(digit, idx) in 4" :key="idx" class="w-4 h-4 rounded-full border-2 border-white transition-all duration-300" 
                                 :class="inputPassword.length > idx ? 'bg-white scale-110 shadow-[0_0_10px_white]' : 'bg-transparent'"></div>
                        </transition-group>
                    </div>

                    <div class="grid grid-cols-3 gap-5 w-full px-4">
                        <button v-for="n in 9" :key="n" @click="enterDigit(n)" class="w-16 h-16 rounded-full bg-white/10 border border-white/30 flex items-center justify-center text-2xl font-light active:bg-white/40 transition hover:bg-white/20">{{ n }}</button>
                        <div class="col-start-2">
                            <button @click="enterDigit(0)" class="w-16 h-16 rounded-full bg-white/10 border border-white/30 flex items-center justify-center text-2xl font-light active:bg-white/40 transition hover:bg-white/20">0</button>
                        </div>
                        <div class="col-start-3 flex items-center justify-center">
                            <button @click="backspace()" class="w-16 h-16 flex items-center justify-center text-xl active:opacity-50 text-white/80"><i class="fa-solid fa-delete-left"></i></button>
                        </div>
                    </div>
                    <p v-if="loginError" class="absolute -bottom-8 text-pink-300 font-bold animate-pulse text-shadow">å¯†ç¢¼éŒ¯èª¤</p>
                </div>
            </div>
        </transition>

        <header class="relative z-10">
            <div class="h-[170px] w-full bg-pink-200 header-curve overflow-hidden relative shadow-md">
                <img :src="headerImage" class="w-full h-full object-cover object-center opacity-90 transition duration-1000 hover:scale-105">
                <div class="absolute bottom-6 left-6 text-white text-shadow">
                    <h1 class="text-2xl font-bold tracking-widest drop-shadow-md">åŒ—æµ·é“ 2026</h1>
                    <p class="text-xs font-light tracking-wider drop-shadow-md opacity-90">æ«»èŠ±èˆ‡ç¾é£Ÿä¹‹æ—… ğŸŒ¸</p>
                </div>
                <div class="absolute top-4 right-4 bg-white/20 backdrop-blur-md text-white text-[10px] px-3 py-1 rounded-full flex items-center border border-white/30 shadow-sm">
                    <div class="w-2 h-2 rounded-full mr-2" :class="dbConnected ? 'bg-green-400' : 'bg-red-400 animate-pulse'"></div>
                    {{ dbConnected ? 'å·²é€£ç·š' : 'é€£ç·šä¸­' }}
                </div>
            </div>
        </header>

        <div class="fixed bottom-6 left-1/2 transform -translate-x-1/2 flex space-x-1 z-50 bg-white/90 backdrop-blur-md px-3 py-2 rounded-full shadow-2xl border border-white/50 ring-1 ring-pink-100">
            <button v-for="tab in ['schedule', 'food', 'shopping', 'expense', 'tools']" @click="switchTab(tab)" 
                    :class="currentTab === tab ? 'bg-gradient-to-tr from-pink-400 to-pink-500 text-white shadow-lg scale-110' : 'text-slate-400 hover:text-pink-400'" 
                    class="w-11 h-11 rounded-full flex items-center justify-center transition-all duration-300">
                <i :class="getTabIcon(tab)" class="text-lg"></i>
            </button>
        </div>

        <main class="relative z-0 -mt-4 pt-4 px-4 min-h-[500px]">

            <div v-if="currentTab === 'schedule'">
                 <div class="flex overflow-x-auto space-x-2 pb-2 hide-scrollbar mb-2">
                    <div v-for="(day, index) in scheduleData" :key="index" @click="selectedDayIndex = index"
                         :class="selectedDayIndex === index ? 'bg-gradient-to-b from-pink-400 to-pink-500 text-white ring-2 ring-pink-200 shadow-md transform -translate-y-1' : 'bg-white text-slate-400 border border-pink-100'"
                         class="flex-shrink-0 w-14 h-16 rounded-xl flex flex-col items-center justify-center cursor-pointer transition-all duration-300">
                        <span class="text-[10px] font-medium opacity-80">{{ day.weekday }}</span>
                        <span class="text-lg font-bold font-mono">{{ day.date }}</span>
                        <span class="text-[9px] opacity-60">D{{ index + 1 }}</span>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-blue-400 to-pink-300 text-white rounded-2xl p-4 mb-4 shadow-sm flex justify-between items-center relative overflow-hidden min-h-[90px]">
                    <div class="relative z-10">
                        <div class="text-xs opacity-90 flex items-center"><i class="fa-solid fa-location-dot mr-1"></i>{{ currentSchedule.location }} <span class="ml-2 text-[10px] opacity-70 border border-white/30 px-1 rounded">å³æ™‚</span></div>
                        <div v-if="weatherLoading" class="mt-1 text-sm opacity-80">å¤©æ°£è¼‰å…¥ä¸­...</div>
                        <div v-else><div class="text-2xl font-bold mt-1">{{ currentWeather.temp }}Â°C <span class="text-sm font-normal">{{ currentWeather.desc }}</span></div></div>
                    </div>
                    <i :class="currentWeather.icon" class="text-4xl opacity-80 relative z-10 drop-shadow-md"></i>
                    <div class="absolute -right-4 -bottom-4 w-20 h-20 bg-white/20 rounded-full blur-xl"></div>
                </div>

                <div class="space-y-0">
                    <div v-for="(item, idx) in currentSchedule.events" :key="idx" class="relative pl-5 pb-6 border-l-2 border-dashed border-pink-200 last:border-0">
                        <div class="absolute -left-[7px] top-0 w-3 h-3 rounded-full bg-pink-400 ring-2 ring-pink-100"></div>
                        <div v-if="idx > 0" class="flex items-center text-[10px] text-slate-400 mb-1 ml-1"><i :class="getTransportIcon(item.transportType)" class="mr-1"></i><span>{{ item.travelTime }}</span></div>
                        <div v-else-if="idx === 0" class="flex items-center text-[10px] text-slate-400 mb-1 ml-1"><i class="fa-solid fa-bed mr-1"></i><span>å¾ä½å®¿å‡ºç™¼</span></div>
                        <div class="bg-white/80 backdrop-blur p-3 rounded-2xl shadow-sm border border-pink-50 relative overflow-hidden group hover:shadow-md transition duration-300">
                            <span :class="getCategoryColor(item.category)" class="absolute top-0 right-0 px-2 py-1 text-[9px] rounded-bl-lg font-bold text-white shadow-sm">{{ item.category }}</span>
                            <div class="flex items-start">
                                <div class="mr-3 mt-1 text-pink-500 text-lg"><i :class="getCategoryIcon(item.category)"></i></div>
                                <div class="flex-1">
                                    <h3 class="font-bold text-slate-700 text-base leading-tight mb-1">{{ item.title }}</h3>
                                    <p class="text-[10px] text-slate-500 font-mono mb-2"><i class="fa-regular fa-clock mr-1"></i>{{ item.time }}</p>
                                    <div v-if="item.image" class="mb-2 mt-1 rounded-lg overflow-hidden h-28 w-full relative group-hover:shadow-inner transition"><img :src="item.image" class="w-full h-full object-cover transition duration-700 group-hover:scale-110"></div>
                                    <p v-if="item.note" class="text-xs text-slate-600 bg-slate-50/50 p-2 rounded-lg mb-2 border border-slate-100">{{ item.note }}</p>
                                    <a :href="'https://www.google.com/maps/search/?api=1&query=' + item.title" target="_blank" class="inline-flex items-center text-[10px] font-bold text-blue-500 mt-1 hover:text-blue-700"><i class="fa-solid fa-location-arrow mr-1"></i> å°èˆª</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'food'">
                <h2 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                    ç¾é£Ÿè¨±é¡˜æ±  <i class="fa-solid fa-utensils ml-2 text-orange-400"></i>
                </h2>
                <div v-if="foodLocations.length === 0" class="text-center py-10 text-slate-400"><p>æŒ‰å³ä¸‹è§’æ–°å¢ç¾é£Ÿåœ°é»ï¼</p></div>
                <div v-for="loc in foodLocations" :key="loc" class="mb-3">
                    <div class="flex justify-between items-center bg-orange-50/80 border border-orange-100 p-3 rounded-xl cursor-pointer hover:bg-orange-100 transition" @click="toggleLocation(loc)">
                        <h3 class="font-bold text-orange-700 text-sm"><i class="fa-solid fa-map-pin mr-2"></i>{{ loc }}</h3>
                        <i class="fa-solid fa-chevron-down text-orange-400 transition text-xs" :class="{'rotate-180': expandedLocations[loc]}"></i>
                    </div>
                    <div v-if="expandedLocations[loc]" class="mt-2 space-y-2 pl-2 border-l-2 border-orange-100 ml-3">
                        <div v-for="item in getFoodsByLocation(loc)" :key="item.id" class="bg-white p-3 rounded-lg shadow-sm flex items-center justify-between border border-slate-50">
                            <div class="flex items-center">
                                <i class="fa-solid fa-burger text-slate-300 mr-3 text-xs"></i>
                                <span :class="{'line-through text-slate-300': item.checked}" class="text-sm">{{ item.name }}</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" :checked="item.checked" @change="toggleFoodCheck(item.id, item.checked)" class="w-5 h-5 text-orange-500 rounded focus:ring-orange-500">
                                <button @click="deleteItem('food', item.id)" class="text-slate-300 hover:text-red-400"><i class="fa-solid fa-trash text-xs"></i></button>
                            </div>
                        </div>
                        <div v-if="getFoodsByLocation(loc).length === 0" class="text-xs text-slate-400 italic p-2">é‚„æ²’è¨±é¡˜ç¾é£Ÿ...</div>
                    </div>
                </div>
                <button @click="showAddModal = 'food'" class="fixed bottom-24 right-6 w-12 h-12 bg-orange-500 text-white rounded-full shadow-lg flex items-center justify-center text-xl z-40 hover:scale-110 transition hover:rotate-90"><i class="fa-solid fa-plus"></i></button>
            </div>

            <div v-if="currentTab === 'shopping'">
                <div v-if="!activeMember">
                    <h2 class="text-lg font-bold text-slate-800 mb-4">å…¨å®¶è³¼ç‰©è»Š <span class="text-xs font-normal text-slate-400 ml-1">(é»æ“Šé€²å…¥)</span></h2>
                    <div class="grid grid-cols-2 gap-3">
                        <div v-for="member in familyMembers" :key="member.name" @click="activeMember = member.name" 
                             class="bg-white/80 backdrop-blur p-5 rounded-2xl shadow-sm border border-pink-50 flex flex-col items-center justify-center cursor-pointer hover:shadow-md hover:border-pink-300 transition relative overflow-hidden">
                            <div class="w-14 h-14 rounded-full mb-2 flex items-center justify-center text-xl shadow-sm" :class="member.bg"><i :class="member.icon"></i></div>
                            <h3 class="font-bold text-slate-700 text-sm">{{ member.name }}</h3>
                            <p class="text-[10px] text-slate-400 mt-1">{{ getMemberItemCount(member.name, 'shopping') }} é …å•†å“</p>
                            <div v-if="getMemberItemCount(member.name, 'shopping') > 0" class="absolute top-3 right-3 w-2 h-2 bg-pink-500 rounded-full animate-ping"></div>
                            <div v-if="getMemberItemCount(member.name, 'shopping') > 0" class="absolute top-3 right-3 w-2 h-2 bg-pink-500 rounded-full"></div>
                        </div>
                    </div>
                </div>
                <div v-else>
                    <div class="flex items-center mb-4">
                        <button @click="activeMember = null" class="mr-3 w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center hover:bg-slate-200"><i class="fa-solid fa-arrow-left"></i></button>
                        <div>
                            <h2 class="text-lg font-bold text-slate-800">{{ activeMember }}çš„é¡˜æœ›</h2>
                            <p class="text-xs text-slate-400">ç¸½é ç®—: Â¥{{ getMemberTotal(activeMember, 'shopping').toLocaleString() }}</p>
                        </div>
                    </div>
                    <div v-if="filteredShoppingList.length === 0" class="text-center py-10 text-slate-400"><i class="fa-solid fa-basket-shopping text-4xl mb-3 opacity-30"></i><p>ç©ºç©ºçš„</p></div>
                    <div v-for="(item) in filteredShoppingList" :key="item.id" class="bg-white rounded-2xl shadow-sm border border-slate-100 p-3 mb-2 flex items-center relative group">
                        <button @click="deleteItem('shopping', item.id)" class="absolute top-2 right-2 text-slate-300 hover:text-red-400"><i class="fa-solid fa-times"></i></button>
                        <div class="w-10 h-10 bg-slate-50 rounded-lg mr-3 flex items-center justify-center text-slate-300"><i class="fa-solid fa-gift"></i></div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-700 text-sm" :class="{'line-through text-slate-300': item.checked}">{{ item.name }}</h4>
                            <p class="text-xs text-slate-400">Â¥{{ item.price }} 
                                <span v-if="item.recipient" class="ml-1 bg-pink-50 text-pink-500 px-2 py-0.5 rounded-full text-[9px]"><i class="fa-solid fa-heart mr-1"></i>çµ¦: {{ item.recipient }}</span>
                            </p>
                        </div>
                        <input type="checkbox" :checked="item.checked" @change="toggleCheck(item.id, item.checked, 'shopping')" class="w-5 h-5 text-pink-500 rounded focus:ring-pink-500">
                    </div>
                    <button @click="showAddModal = 'shopping'" class="fixed bottom-24 right-6 w-12 h-12 bg-pink-500 text-white rounded-full shadow-lg flex items-center justify-center text-xl z-40 hover:scale-110 transition hover:rotate-90"><i class="fa-solid fa-plus"></i></button>
                </div>
            </div>

            <div v-if="currentTab === 'expense'">
                <div v-if="!activeMember">
                    <div class="bg-gradient-to-br from-slate-700 to-slate-800 text-white rounded-2xl p-5 mb-6 shadow-lg text-center relative overflow-hidden">
                        <div class="relative z-10">
                            <p class="text-xs opacity-70 mb-1">å…¨å®¶ç¸½èŠ±è²» (TWD)</p>
                            <h3 class="text-3xl font-bold font-mono">{{ totalExpenseTWD.toLocaleString() }}</h3>
                        </div>
                        <div class="absolute -right-6 -bottom-6 w-24 h-24 bg-white/10 rounded-full blur-2xl"></div>
                    </div>
                    <h2 class="text-lg font-bold text-slate-800 mb-3">èª°ä»˜çš„éŒ¢ï¼Ÿ</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <div v-for="member in familyMembers" :key="member.name" @click="activeMember = member.name" 
                             class="bg-white/80 p-4 rounded-2xl shadow-sm border border-slate-100 flex items-center cursor-pointer hover:shadow-md transition">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center text-lg mr-3 shadow-sm" :class="member.bg"><i :class="member.icon"></i></div>
                            <div>
                                <h3 class="font-bold text-sm text-slate-700">{{ member.name }}</h3>
                                <p class="text-[10px] font-mono text-slate-400">Â¥{{ getMemberTotal(member.name, 'expense').toLocaleString() }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div v-else>
                    <div class="flex items-center mb-4">
                        <button @click="activeMember = null" class="mr-3 w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center hover:bg-slate-200"><i class="fa-solid fa-arrow-left"></i></button>
                        <div>
                            <h2 class="text-lg font-bold text-slate-800">{{ activeMember }}ä»˜çš„éŒ¢</h2>
                            <p class="text-xs text-slate-400">å°è¨ˆ: Â¥{{ getMemberTotal(activeMember, 'expense').toLocaleString() }}</p>
                        </div>
                    </div>
                    <div v-for="(exp) in filteredExpenseList" :key="exp.id" class="flex justify-between items-center bg-white p-3 rounded-xl shadow-sm border border-slate-50 relative mb-2">
                        <button @click="deleteItem('expense', exp.id)" class="absolute top-2 right-2 text-[10px] text-slate-200 hover:text-red-400"><i class="fa-solid fa-trash"></i></button>
                        <div class="flex items-center">
                            <div class="w-9 h-9 rounded-full bg-yellow-50 text-yellow-500 flex items-center justify-center mr-3"><i class="fa-solid fa-yen-sign"></i></div>
                            <div><p class="font-bold text-sm">{{ exp.name }}</p><p class="text-[10px] text-slate-400">{{ exp.date }}</p></div>
                        </div>
                        <span class="font-mono font-bold text-slate-700">Â¥ {{ Number(exp.amount).toLocaleString() }}</span>
                    </div>
                    <button @click="showAddModal = 'expense'" class="fixed bottom-24 right-6 w-12 h-12 bg-slate-800 text-white rounded-full shadow-lg flex items-center justify-center text-xl z-40 hover:scale-110 transition hover:rotate-90"><i class="fa-solid fa-plus"></i></button>
                </div>
            </div>

            <div v-if="currentTab === 'tools'">
                <h2 class="text-lg font-bold text-slate-800 mb-4">ç™¾å¯¶ç®±</h2>

                <div class="mb-5">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-bold text-slate-700 text-sm"><i class="fa-solid fa-ticket mr-2 text-indigo-500"></i>é›»å­ç¥¨åˆ¸</h3>
                        <button @click="showAddModal = 'ticket'" class="text-[10px] bg-indigo-50 text-indigo-600 px-2 py-1 rounded-full border border-indigo-100">æ–°å¢</button>
                    </div>
                    <div class="flex overflow-x-auto space-x-3 pb-2 hide-scrollbar">
                        <div v-if="tickets.length === 0" class="text-xs text-slate-400 p-2">æš«ç„¡ç¥¨åˆ¸</div>
                        <div v-for="t in tickets" :key="t.id" class="flex-shrink-0 w-36 bg-white p-3 rounded-xl border border-indigo-50 shadow-sm relative group">
                            <button @click="deleteItem('ticket', t.id)" class="absolute top-1 right-1 text-slate-300 hover:text-red-400"><i class="fa-solid fa-times text-xs"></i></button>
                            <div class="text-[10px] text-indigo-400 font-bold mb-1">{{ t.type }}</div>
                            <div class="font-bold text-slate-700 truncate text-sm">{{ t.name }}</div>
                            <div class="text-[9px] text-slate-400 truncate">{{ t.note }}</div>
                            <a v-if="t.link" :href="t.link" target="_blank" class="block mt-2 text-center text-[10px] bg-indigo-50 text-indigo-600 py-1 rounded hover:bg-indigo-100">æŸ¥çœ‹</a>
                        </div>
                    </div>
                </div>

                <div class="mb-5">
                    <h3 class="font-bold text-slate-700 mb-2 text-sm"><i class="fa-solid fa-clipboard-check mr-2 text-green-500"></i>è¡Œå‰æª¢æŸ¥</h3>
                    <div v-if="!activeChecklistMember" class="grid grid-cols-4 gap-2">
                        <div v-for="member in familyMembers" :key="member.name" @click="activeChecklistMember = member.name" class="flex flex-col items-center cursor-pointer bg-white p-2 rounded-xl border border-slate-50 shadow-sm hover:border-green-300 transition">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm mb-1" :class="member.bg"><i :class="member.icon"></i></div>
                            <span class="text-[10px] text-slate-500">{{ member.name }}</span>
                        </div>
                    </div>
                    <div v-else class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="font-bold text-slate-700 text-sm">{{ activeChecklistMember }}çš„è¡Œæ</h4>
                            <button @click="activeChecklistMember = null" class="text-xs text-slate-400">è¿”å›</button>
                        </div>
                        <div class="space-y-2">
                            <div v-for="item in getChecklist(activeChecklistMember)" :key="item.id" class="flex items-center justify-between">
                                <label class="flex items-center text-sm text-slate-600">
                                    <input type="checkbox" :checked="item.checked" @change="toggleCheck(item.id, item.checked, 'checklist')" class="mr-2 text-green-500 rounded focus:ring-green-500">
                                    <span :class="{'line-through opacity-50': item.checked}">{{ item.name }}</span>
                                </label>
                                <button @click="deleteItem('checklist', item.id)" class="text-slate-300 hover:text-red-400"><i class="fa-solid fa-times text-xs"></i></button>
                            </div>
                            <div class="pt-2 border-t border-slate-50 mt-2 flex">
                                <input v-model="newChecklistItem" placeholder="æ–°å¢..." class="flex-1 text-xs bg-slate-50 rounded-l px-2 py-2 outline-none">
                                <button @click="addChecklistItem" class="bg-green-500 text-white px-3 rounded-r text-xs">åŠ </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-2xl shadow-sm border border-blue-50">
                    <h3 class="font-bold text-blue-500 mb-2 text-sm"><i class="fa-solid fa-coins mr-1"></i>åŒ¯ç‡è¨ˆç®—</h3>
                    <div class="flex items-center bg-blue-50/50 rounded px-2 py-1 mb-2"><span class="text-xs text-slate-400 mr-2">1 JPY =</span><input v-model="exchangeRate" type="number" step="0.001" class="w-16 text-right font-bold text-blue-600 outline-none text-sm bg-transparent"><span class="text-xs text-slate-400 ml-1">TWD</span></div>
                    <div class="flex items-center space-x-2">
                        <div class="flex-1"><input v-model="yenAmount" type="number" class="w-full bg-slate-100 rounded-lg p-2 outline-none font-mono text-sm"></div>
                        <i class="fa-solid fa-arrow-right text-slate-300 text-xs"></i>
                        <div class="flex-1"><div class="w-full bg-slate-200 rounded-lg p-2 font-mono font-bold text-slate-700 text-sm text-center">{{ calculatedTwd }}</div></div>
                    </div>
                </div>
            </div>

        </main>

        <div v-if="showAddModal" class="fixed inset-0 bg-black/50 z-[60] flex items-end sm:items-center justify-center p-4 backdrop-blur-sm">
            <div class="bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl animate-bounce-in border border-slate-100">
                
                <div v-if="showAddModal === 'food'">
                    <h3 class="text-lg font-bold mb-4">è¨±é¡˜æƒ³åƒä»€éº¼ï¼Ÿ</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs text-slate-400 mb-1">åœ°é»</label>
                            <div class="flex space-x-2 overflow-x-auto pb-1 mb-1">
                                <button v-for="loc in foodLocations" @click="newItem.location = loc" :class="newItem.location === loc ? 'bg-orange-500 text-white' : 'bg-slate-100 text-slate-500'" class="px-3 py-1 rounded-full text-xs whitespace-nowrap">{{ loc }}</button>
                            </div>
                            <input v-model="newItem.location" type="text" class="w-full bg-slate-100 rounded-lg p-3 outline-none" placeholder="æˆ–è¼¸å…¥æ–°åœ°é» (å¦‚: æœ­å¹Œ)">
                        </div>
                        <div><label class="block text-xs text-slate-400 mb-1">ç¾é£Ÿåç¨±</label><input v-model="newItem.name" type="text" class="w-full bg-slate-100 rounded-lg p-3 outline-none" placeholder="ä¾‹å¦‚: æ¹¯å’–å“©"></div>
                    </div>
                </div>

                <div v-else-if="showAddModal === 'ticket'">
                    <h3 class="text-lg font-bold mb-4">æ–°å¢ç¥¨åˆ¸</h3>
                    <div class="space-y-3">
                        <div><label class="block text-xs text-slate-400 mb-1">åç¨±</label><input v-model="newItem.name" class="w-full bg-slate-100 rounded-lg p-3 outline-none"></div>
                        <div><label class="block text-xs text-slate-400 mb-1">é¡å‹</label><select v-model="newItem.type" class="w-full bg-slate-100 rounded-lg p-3 outline-none"><option value="æ©Ÿç¥¨">æ©Ÿç¥¨</option><option value="ä½å®¿">ä½å®¿</option><option value="é–€ç¥¨">é–€ç¥¨</option><option value="ç§Ÿè»Š">ç§Ÿè»Š</option></select></div>
                        <div><label class="block text-xs text-slate-400 mb-1">é€£çµ (URL)</label><input v-model="newItem.link" class="w-full bg-slate-100 rounded-lg p-3 outline-none"></div>
                        <div><label class="block text-xs text-slate-400 mb-1">å‚™è¨»</label><input v-model="newItem.note" class="w-full bg-slate-100 rounded-lg p-3 outline-none"></div>
                    </div>
                </div>

                <div v-else>
                    <h3 class="text-lg font-bold mb-4">{{ showAddModal === 'shopping' ? activeMember + 'æƒ³è²·ä»€éº¼?' : activeMember + 'ä»˜äº†ä»€éº¼éŒ¢?' }}</h3>
                    <div class="space-y-3">
                        <div><label class="block text-xs text-slate-400 mb-1">åç¨±</label><input v-model="newItem.name" class="w-full bg-slate-100 rounded-lg p-3 outline-none"></div>
                        <div><label class="block text-xs text-slate-400 mb-1">é‡‘é¡ (Â¥)</label><input v-model="newItem.amount" type="number" class="w-full bg-slate-100 rounded-lg p-3 outline-none"></div>
                        <div v-if="showAddModal === 'shopping'"><label class="block text-xs text-slate-400 mb-1">é€çµ¦èª°ï¼Ÿ</label><input v-model="newItem.recipient" class="w-full bg-pink-50 rounded-lg p-3 outline-none text-pink-600"></div>
                        <div v-if="showAddModal === 'expense'"><label class="block text-xs text-slate-400 mb-1">æ—¥æœŸ</label><input v-model="newItem.date" type="date" class="w-full bg-slate-100 rounded-lg p-3 outline-none"></div>
                    </div>
                </div>

                <div class="flex space-x-3 mt-6">
                    <button @click="closeModal" class="flex-1 py-3 rounded-xl bg-slate-100 text-slate-500 font-bold">å–æ¶ˆ</button>
                    <button @click="confirmAdd" class="flex-1 py-3 rounded-xl bg-blue-500 text-white font-bold">ç¢ºå®š</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { createApp } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js';
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // âœ… æ‚¨çš„ Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyC67N7fPsE8dHL3GMVfFpyfgrvDnE5AaVQ",
            authDomain: "hokkaido2026-b35fc.firebaseapp.com",
            databaseURL: "https://hokkaido2026-b35fc-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "hokkaido2026-b35fc",
            storageBucket: "hokkaido2026-b35fc.firebasestorage.app",
            messagingSenderId: "553111751124",
            appId: "1:553111751124:web:e15688b7b8966926882e41"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ğŸŒ¸ æ«»èŠ±ç‰ˆå¤§åœ–
        const headerImage = "https://images.unsplash.com/photo-1522383225653-ed111181a951?q=80&w=1920&auto=format&fit=crop";

        // ğŸ“ å®Œæ•´ D1-D9 è¡Œç¨‹ (å·²ä¿®å¾©ï¼Œå«æ«»èŠ±åœ–ç‰‡)
        const scheduleData = [
            {
                date: "25", weekday: "Fri", location: "å‡½é¤¨", lat: 41.7687, lng: 140.7290,
                events: [
                    { time: "13:00", title: "æŠµé”æ–°åƒæ­²è½‰åœ‹å…§ç·š", category: "èˆªç­", transportType: "plane", travelTime: "1h", note: "è½‰æ©Ÿå¾€å‡½é¤¨ (å‚™æ¡ˆJR)", image: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=800&q=80" },
                    { time: "16:30", title: "å‡½é¤¨ Check-in", category: "ä½å®¿", transportType: "taxi", travelTime: "20m", note: "å‡½é¤¨ç«™å‰é£¯åº—", image: "https://images.unsplash.com/photo-1566073771259-6a8506099945?w=800&q=80" },
                    { time: "17:30", title: "å‡½é¤¨æœå¸‚ / é‡‘æ£®å€‰åº«", category: "æ™¯é»", transportType: "walk", travelTime: "10m", note: "ç´…ç£šå€‰åº«æ•£æ­¥", image: "https://images.unsplash.com/photo-1542044801-30d3e45ae49a?w=800&q=80" },
                    { time: "19:00", title: "æ ¹å®¤èŠ±ä¸¸å£½å¸", category: "ç¾é£Ÿ", transportType: "walk", travelTime: "5m", note: "è¿´è½‰å£½å¸æ™šé¤", image: "https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=800&q=80" }
                ]
            },
            {
                date: "26", weekday: "Sat", location: "å‡½é¤¨", lat: 41.7687, lng: 140.7290,
                events: [
                    { time: "09:00", title: "æ«»ä¸˜é€šè³æ«»", category: "æ™¯é»", transportType: "taxi", travelTime: "15m", note: "æ«»èŠ±éš§é“", image: "https://images.unsplash.com/photo-1522383225653-ed111181a951?w=800&q=80" },
                    { time: "10:30", title: "äº”ç¨œéƒ­å…¬åœ’", category: "æ™¯é»", transportType: "walk", travelTime: "10m", note: "ç™»ä¸Šäº”ç¨œéƒ­å¡”", image: "https://images.unsplash.com/photo-1594970921430-47b19df49b82?w=800&q=80" },
                    { time: "12:30", title: "å°ä¸‘æ¼¢å ¡", category: "ç¾é£Ÿ", transportType: "walk", travelTime: "5m", note: "å¿…åƒ! å¹¸é‹å°ä¸‘", image: "https://images.unsplash.com/photo-1551782450-a2132b4ba21d?w=800&q=80" },
                    { time: "15:30", title: "é‡‘æ£®å€‰åº«/æ˜Ÿå·´å…‹", category: "è³¼ç‰©", transportType: "bus", travelTime: "20m", note: "ä¼‘æ¯ã€å–å’–å•¡", image: "https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=800&q=80" },
                    { time: "17:30", title: "å‡½é¤¨å±±å¤œæ™¯", category: "æ™¯é»", transportType: "bus", travelTime: "20m", note: "ç™¾è¬å¤œæ™¯ Magic Hour", image: "https://images.unsplash.com/photo-1533050487297-09b450131914?w=800&q=80" }
                ]
            },
            {
                date: "27", weekday: "Sun", location: "å‡½é¤¨", lat: 41.7687, lng: 140.7290,
                events: [
                    { time: "09:00", title: "å‡½é¤¨æœå¸‚", category: "ç¾é£Ÿ", transportType: "walk", travelTime: "10m", note: "æ—©é¤/é‡£çƒè³Š", image: "https://images.unsplash.com/photo-1534483509719-3feaee7c30da?w=800&q=80" },
                    { time: "11:00", title: "å…ƒç”ºæ•™æœƒç¾¤", category: "æ™¯é»", transportType: "walk", travelTime: "15m", note: "ç•°åœ‹é¢¨æƒ…è¡—é“", image: "https://plus.unsplash.com/premium_photo-1661962495669-d72424626bd2?w=800&q=80" },
                    { time: "15:00", title: "å‡½é¤¨å…¬åœ’", category: "æ™¯é»", transportType: "bus", travelTime: "20m", note: "è³æ«»èˆ‡è¿·ä½ éŠæ¨‚åœ’", image: "https://images.unsplash.com/photo-1572455044327-7348c1be7267?w=800&q=80" },
                    { time: "16:30", title: "é‡‘æ£®å€‰åº«æœ€å¾Œæ¡è²·", category: "è³¼ç‰©", transportType: "taxi", travelTime: "10m", note: "Snaffle's èµ·å¸è›‹ç³•", image: "https://images.unsplash.com/photo-1557925923-4706d5eb3d19?w=800&q=80" },
                    { time: "18:30", title: "é˜¿ä½åˆ©å£½å–œç‡’", category: "ç¾é£Ÿ", transportType: "walk", travelTime: "5m", note: "å’Œç‰›å£½å–œç‡’ (éœ€é ç´„)", image: "https://images.unsplash.com/photo-1588636402444-118e98b04618?w=800&q=80" }
                ]
            },
            {
                date: "28", weekday: "Mon", location: "äºŒä¸–è°·", lat: 42.8048, lng: 140.6874,
                events: [
                    { time: "09:30", title: "å‡½é¤¨å–è»Š & å¯„è¡Œæ", category: "ç§Ÿè»Š", transportType: "walk", travelTime: "10m", note: "è‡ªé§•é–‹å§‹ï¼", image: "https://images.unsplash.com/photo-1449965408869-eaa3f722e40d?w=800&q=80" },
                    { time: "10:30", title: "å¤§æ²¼åœ‹å®šå…¬åœ’", category: "æ™¯é»", transportType: "car", travelTime: "40m", note: "é§’ä¹‹å²³çµ•æ™¯", image: "https://images.unsplash.com/photo-1624623253738-9e5c4908970d?w=800&q=80" },
                    { time: "12:00", title: "æ£®ç”ºãƒ»é’è‘‰ä¸˜", category: "æ™¯é»", transportType: "car", travelTime: "20m", note: "è³æ«»ç§˜å¢ƒ", image: "https://images.unsplash.com/photo-1493589976221-c2157d91244d?w=800&q=80" },
                    { time: "14:30", title: "Silo å±•æœ›å°", category: "æ™¯é»", transportType: "car", travelTime: "90m", note: "çœºæœ›æ´çˆºæ¹–", image: "https://images.unsplash.com/photo-1517769971842-88f4b0051e23?w=800&q=80" },
                    { time: "15:30", title: "Lake Hill Farm", category: "ç¾é£Ÿ", transportType: "car", travelTime: "10m", note: "ç‰§å ´å†°æ·‡æ·‹", image: "https://images.unsplash.com/photo-1563228965-03d3c4033288?w=800&q=80" },
                    { time: "18:00", title: "å…¥ä½äºŒä¸–è°·åˆ¥å¢…", category: "ä½å®¿", transportType: "car", travelTime: "40m", note: "æ™šé¤ï¼šæµ·é®®ç«é‹", image: "https://images.unsplash.com/photo-1566665797739-1674de7a421a?w=800&q=80" }
                ]
            },
            {
                date: "29", weekday: "Tue", location: "æ´çˆºæ¹–", lat: 42.5646, lng: 140.8576,
                events: [
                    { time: "11:00", title: "å‡ºç™¼æ´çˆºæ¹–", category: "äº¤é€š", transportType: "car", travelTime: "0m", note: "ç¡åˆ°è‡ªç„¶é†’", image: "https://images.unsplash.com/photo-1558223694-8451b279d63f?w=800&q=80" },
                    { time: "12:30", title: "æœ‰ç å±±çºœè»Š", category: "æ™¯é»", transportType: "car", travelTime: "60m", note: "çœ‹ç«å±±åœ°å½¢", image: "https://images.unsplash.com/photo-1545653494-b772c672b152?w=800&q=80" },
                    { time: "14:30", title: "æ´çˆºæ¹–éŠè¦½èˆ¹", category: "æ™¯é»", transportType: "car", travelTime: "20m", note: "ä¸­å³¶è³æ«»", image: "https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=800&q=80" },
                    { time: "17:00", title: "è¶…å¸‚è£œè²¨", category: "è³¼ç‰©", transportType: "car", travelTime: "15m", note: "è²·æ™šé¤é£Ÿæ", image: "https://images.unsplash.com/photo-1578916171728-46686eac8d58?w=800&q=80" },
                    { time: "19:00", title: "åˆ¥å¢…æ™šé¤", category: "ç¾é£Ÿ", transportType: "walk", travelTime: "0m", note: "è‡ªè£½æ¹¯å’–å“©", image: "https://images.unsplash.com/photo-1555126634-323283e090fa?w=800&q=80" }
                ]
            },
            {
                date: "30", weekday: "Wed", location: "ç™»åˆ¥", lat: 42.4124, lng: 141.1065,
                events: [
                    { time: "10:00", title: "å‡ºç™¼ç™»åˆ¥", category: "äº¤é€š", transportType: "car", travelTime: "0m", note: "ç§»å‹•æ—¥", image: "https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=800&q=80" },
                    { time: "11:30", title: "ç™»åˆ¥æ«»èŠ±éš§é“", category: "æ™¯é»", transportType: "car", travelTime: "90m", note: "è³æ«»å‹åœ°", image: "https://images.unsplash.com/photo-1524231757912-21f4fe3a7200?w=800&q=80" },
                    { time: "13:30", title: "ç™»åˆ¥åœ°ç„è°·", category: "æ™¯é»", transportType: "car", travelTime: "10m", note: "åœ°ç†±æ™¯è§€", image: "https://images.unsplash.com/photo-1600613277026-64539c279c09?w=800&q=80" },
                    { time: "16:00", title: "é«˜æ©‹ç‰§å ´", category: "ç¾é£Ÿ", transportType: "car", travelTime: "80m", note: "å¹´è¼ªè›‹ç³•/æ³¡èŠ™", image: "https://images.unsplash.com/photo-1529566118393-6cd79805d76d?w=800&q=80" },
                    { time: "17:00", title: "äº¬æ¥µåæ°´å…¬åœ’", category: "æ™¯é»", transportType: "car", travelTime: "20m", note: "è£åæ°´å›åˆ¥å¢…", image: "https://images.unsplash.com/photo-1433086966358-54859d0ed716?w=800&q=80" },
                    { time: "19:00", title: "åˆ¥å¢…æ™šé¤", category: "ç¾é£Ÿ", transportType: "walk", travelTime: "0m", note: "å’Œç‰›ç‡’è‚‰è¶´", image: "https://images.unsplash.com/photo-1558030006-450675393462?w=800&q=80" }
                ]
            },
            {
                date: "01", weekday: "Thu", location: "å°æ¨½", lat: 43.1907, lng: 140.9947,
                events: [
                    { time: "10:00", title: "äºŒä¸–è°·é‚„è»Š", category: "ç§Ÿè»Š", transportType: "car", travelTime: "0m", note: "æ› Alphard åŒ…è»Š", image: "https://images.unsplash.com/photo-1621905251189-08b45d6a269e?w=800&q=80" },
                    { time: "11:30", title: "ä½™å¸‚é…’å» +å ¤é˜²", category: "æ™¯é»", transportType: "car", travelTime: "60m", note: "å¨å£«å¿Œé…’å» ", image: "https://images.unsplash.com/photo-1596706912386-8a7c20c9f692?w=800&q=80" },
                    { time: "13:00", title: "å°æ¨½é‹æ²³ & åˆé¤", category: "æ™¯é»", transportType: "car", travelTime: "30m", note: "è‹¥é›æ™‚ä»£/æ”¿å£½å¸", image: "https://images.unsplash.com/photo-1589453966567-27b4f5319803?w=800&q=80" },
                    { time: "15:00", title: "å ºç”ºé€š / æ‰‹å®®å…¬åœ’", category: "è³¼ç‰©", transportType: "walk", travelTime: "10m", note: "ç”œé»è¡—è³æ«»", image: "https://images.unsplash.com/photo-1527265103685-610190369888?w=800&q=80" },
                    { time: "17:30", title: "æœ­å¹Œ Check-in", category: "ä½å®¿", transportType: "car", travelTime: "50m", note: "è¡Œæåˆé«”", image: "https://images.unsplash.com/photo-1620286866164-323620958d56?w=800&q=80" }
                ]
            },
            {
                date: "02", weekday: "Fri", location: "æœ­å¹Œ", lat: 43.0618, lng: 141.3545,
                events: [
                    { time: "10:00", title: "åŒ—æµ·é“ç¥å®®", category: "æ™¯é»", transportType: "subway", travelTime: "20m", note: "åƒæ‹œ", image: "https://images.unsplash.com/photo-1590499690106-993d98fb870c?w=800&q=80" },
                    { time: "11:30", title: "åœ“å±±å…¬åœ’", category: "æ™¯é»", transportType: "walk", travelTime: "5m", note: "é‡é¤/è³æ«»", image: "https://images.unsplash.com/photo-1616556111075-8126b8061e88?w=800&q=80" },
                    { time: "12:30", title: "åœ“å±±å’–å•¡å»³", category: "ç¾é£Ÿ", transportType: "walk", travelTime: "10m", note: "æ–‡é’åˆé¤", image: "https://images.unsplash.com/photo-1554118811-1e0d58224f24?w=800&q=80" },
                    { time: "14:30", title: "åŒ—æµ·é“å¤§å­¸", category: "æ™¯é»", transportType: "subway", travelTime: "20m", note: "æ ¡åœ’æ•£æ­¥", image: "https://images.unsplash.com/photo-1634788102377-160171221430?w=800&q=80" },
                    { time: "16:30", title: "ç‹¸å°è·¯é€›è¡—", category: "è³¼ç‰©", transportType: "subway", travelTime: "15m", note: "è—¥å¦/ä¼´æ‰‹ç¦®", image: "https://images.unsplash.com/photo-1579758629938-03607ccdbaba?w=800&q=80" },
                    { time: "18:30", title: "æˆå‰æ€æ±—çƒ¤è‚‰", category: "ç¾é£Ÿ", transportType: "walk", travelTime: "10m", note: "å¤§å£åƒç¾Šè‚‰", image: "https://images.unsplash.com/photo-1594040226829-7f251ab46d80?w=800&q=80" }
                ]
            },
            {
                date: "03", weekday: "Sat", location: "åƒæ­²", lat: 42.7937, lng: 141.6795,
                events: [
                    { time: "10:30", title: "é£¯åº—æ¥é€", category: "äº¤é€š", transportType: "taxi", travelTime: "0m", note: "å°ˆè»Šç›´é”æ©Ÿå ´", image: "https://images.unsplash.com/photo-1632304918731-016335129995?w=800&q=80" },
                    { time: "11:30", title: "æ–°åƒæ­²æ©Ÿå ´", category: "è³¼ç‰©", transportType: "car", travelTime: "50m", note: "æœ€å¾Œæ¡è²·", image: "https://images.unsplash.com/photo-1569154941061-e231b4725ef1?w=800&q=80" },
                    { time: "13:00", title: "æ­æ©Ÿè¿”å°", category: "èˆªç­", transportType: "plane", travelTime: "0m", note: "ç”œèœœçš„å®¶", image: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=800&q=80" }
                ]
            }
        ];

        createApp({
            data() {
                return {
                    isLocked: true, password: ['0','4','2','3'], inputPassword: [], loginError: false,
                    headerImage: headerImage,
                    currentTab: 'schedule', scheduleData: scheduleData, selectedDayIndex: 0,
                    yenAmount: 1000, exchangeRate: 0.215,
                    
                    // è³‡æ–™
                    shoppingList: [], expenseList: [], foods: [], checklist: [], tickets: [],
                    loading: true, dbConnected: false,
                    
                    // UI ç‹€æ…‹
                    activeMember: null, activeChecklistMember: null,
                    showAddModal: null, newItem: { name: '', amount: '', date: '', recipient: '', location: '', type: 'æ©Ÿç¥¨', link: '', note: '' },
                    newChecklistItem: '',
                    expandedLocations: {}, 

                    familyMembers: [
                        { name: 'çˆ¸çˆ¸', icon: 'fa-solid fa-user-tie', bg: 'bg-blue-100 text-blue-500' },
                        { name: 'åª½åª½', icon: 'fa-solid fa-user-nurse', bg: 'bg-pink-100 text-pink-500' },
                        { name: 'å“¥å“¥', icon: 'fa-solid fa-user-graduate', bg: 'bg-green-100 text-green-500' },
                        { name: 'å¼Ÿå¼Ÿ', icon: 'fa-solid fa-child-reaching', bg: 'bg-yellow-100 text-yellow-500' }
                    ],
                    weatherLoading: false, currentWeather: { temp: '--', desc: 'è¼‰å…¥ä¸­', icon: 'fa-solid fa-cloud' }
                }
            },
            mounted() {
                // Firebase ç›£è½
                const refs = ['shopping', 'expenses', 'foods', 'checklist', 'tickets'];
                refs.forEach(key => {
                    onValue(ref(db, key), (s) => {
                        const d = s.val();
                        const list = d ? Object.keys(d).map(k => ({id: k, ...d[k]})) : [];
                        if(key === 'shopping') this.shoppingList = list;
                        if(key === 'expenses') this.expenseList = list;
                        if(key === 'foods') this.foods = list;
                        if(key === 'checklist') this.checklist = list;
                        if(key === 'tickets') this.tickets = list;
                    });
                });
                this.dbConnected = true;
                this.newItem.date = new Date().toISOString().split('T')[0];
                this.fetchWeather();
            },
            watch: { selectedDayIndex() { this.fetchWeather(); } },
            computed: {
                currentSchedule() { return this.scheduleData[this.selectedDayIndex] || { events: [] }; },
                calculatedTwd() { return Math.round(this.yenAmount * this.exchangeRate).toLocaleString(); },
                totalExpenseTWD() { return Math.round(this.expenseList.reduce((sum, item) => sum + Number(item.amount), 0) * this.exchangeRate); },
                filteredShoppingList() { return this.shoppingList.filter(item => item.creator === this.activeMember); },
                filteredExpenseList() { return this.expenseList.filter(item => item.creator === this.activeMember); },
                foodLocations() { return [...new Set(this.foods.map(i => i.location))].sort(); }
            },
            methods: {
                getFoodsByLocation(loc) { return this.foods.filter(i => i.location === loc); },
                toggleLocation(loc) { this.expandedLocations[loc] = !this.expandedLocations[loc]; },
                getChecklist(name) { return this.checklist.filter(i => i.owner === name); },
                addChecklistItem() {
                    if(!this.newChecklistItem || !this.activeChecklistMember) return;
                    push(ref(db, 'checklist'), { name: this.newChecklistItem, owner: this.activeChecklistMember, checked: false });
                    this.newChecklistItem = '';
                },
                getMemberItemCount(name, type) { return (type==='shopping'?this.shoppingList:this.expenseList).filter(i => i.creator === name).length; },
                getMemberTotal(name, type) { return (type==='shopping'?this.shoppingList:this.expenseList).filter(i => i.creator === name).reduce((sum, i) => sum + Number(type==='shopping'?i.price:i.amount), 0); },
                switchTab(tab) { this.currentTab = tab; this.activeMember = null; this.activeChecklistMember = null; },
                async fetchWeather() {
                    this.weatherLoading = true; const day = this.currentSchedule; if (!day.lat) return;
                    try {
                        const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${day.lat}&longitude=${day.lng}&current_weather=true`);
                        const data = await res.json();
                        const w = data.current_weather;
                        let icon='fa-solid fa-cloud', desc='å¤šé›²';
                        if(w.weathercode===0){icon='fa-solid fa-sun text-yellow-400';desc='æ™´';}
                        else if(w.weathercode<=67){icon='fa-solid fa-cloud-rain text-blue-300';desc='é›¨';}
                        this.currentWeather = { temp: w.temperature, desc: desc, icon: icon };
                    } catch(e){} finally{this.weatherLoading=false;}
                },
                enterDigit(n) { if(this.inputPassword.length<4) { this.inputPassword.push(String(n)); if(this.inputPassword.length===4) this.checkPassword(); } },
                backspace() { this.inputPassword.pop(); this.loginError=false; },
                checkPassword() { 
                    if(JSON.stringify(this.inputPassword) === JSON.stringify(this.password)) setTimeout(() => this.isLocked = false, 300);
                    else { this.loginError = true; setTimeout(() => { this.inputPassword=[]; this.loginError=false; }, 1000); }
                },
                getTabIcon(t) { return {'schedule':'fa-solid fa-map-location-dot','food':'fa-solid fa-utensils','shopping':'fa-solid fa-basket-shopping','expense':'fa-solid fa-yen-sign','tools':'fa-solid fa-toolbox'}[t]; },
                getTransportIcon(t) { return {'walk':'fa-solid fa-person-walking','car':'fa-solid fa-car-side','bus':'fa-solid fa-bus','subway':'fa-solid fa-train-subway','taxi':'fa-solid fa-taxi','plane':'fa-solid fa-plane-up'}[t] || 'fa-solid fa-arrow-right'; },
                getCategoryColor(c) { return {'æ™¯é»':'bg-pink-400','ç¾é£Ÿ':'bg-orange-400','ä½å®¿':'bg-indigo-400','è³¼ç‰©':'bg-yellow-400','èˆªç­':'bg-blue-400','ç§Ÿè»Š':'bg-green-500'}[c] || 'bg-gray-400'; },
                getCategoryIcon(c) { return {'æ™¯é»':'fa-solid fa-camera','ç¾é£Ÿ':'fa-solid fa-utensils','ä½å®¿':'fa-solid fa-bed','è³¼ç‰©':'fa-solid fa-bag-shopping','èˆªç­':'fa-solid fa-plane','ç§Ÿè»Š':'fa-solid fa-car'}[c] || 'fa-solid fa-circle'; },
                closeModal() { this.showAddModal = null; this.newItem = { name:'', amount:'', date: new Date().toISOString().split('T')[0], recipient: '', location: '', type: 'æ©Ÿç¥¨', link: '', note: '' }; },
                confirmAdd() {
                    if (!this.newItem.name) return;
                    if (this.showAddModal === 'food') {
                        push(ref(db, 'foods'), { name: this.newItem.name, location: this.newItem.location || 'æœªåˆ†é¡', checked: false });
                        this.expandedLocations[this.newItem.location] = true;
                    } else if (this.showAddModal === 'ticket') {
                        push(ref(db, 'tickets'), { name: this.newItem.name, type: this.newItem.type, link: this.newItem.link, note: this.newItem.note });
                    } else if (this.showAddModal === 'shopping') {
                        push(ref(db, 'shopping'), { name: this.newItem.name, price: this.newItem.amount || 0, creator: this.activeMember, recipient: this.newItem.recipient, checked: false });
                    } else if (this.showAddModal === 'expense') {
                        push(ref(db, 'expenses'), { name: this.newItem.name, amount: this.newItem.amount || 0, date: this.newItem.date, creator: this.activeMember });
                    }
                    this.closeModal();
                },
                deleteItem(type, id) { if(confirm('ç¢ºå®šåˆªé™¤?')) remove(ref(db, (type==='food'?'foods/':type==='ticket'?'tickets/':type==='checklist'?'checklist/':type==='shopping'?'shopping/':'expenses/')+id)); },
                toggleCheck(id, s, type) { 
                    const path = type === 'checklist' ? `checklist/${id}` : type === 'shopping' ? `shopping/${id}` : `foods/${id}`;
                    update(ref(db, path), { checked: !s }); 
                },
                toggleFoodCheck(id, s) { this.toggleCheck(id, s, 'food'); }
            }
        }).mount('#app');
    </script>
</body>
</html>

